@using System.Globalization
@using FoodTruck.DAL
@using FoodTruck.ViewModels
@using FoodTruck.Models
@using System.Configuration
@{string dossierImagesArticles = ConfigurationManager.AppSettings["PathImagesArticles"]; }
@model ArticleIndexViewModel
@{
    ViewBag.Title = "FoodTruckLyon - Notre carte";
    List<FamilleArticle> familles = new ArticleDAL().FamillesArticle();
    int familleId = familles[0].Id;
    int indexId = familles.FindIndex(f => f.Id == familleId);
    int i = 0;
}
@while (i < Model.Articles.Count)
{
    <hr />
    <div @*id="@familles[indexId].Id"*@><h2 class="familleNotreCarte">@familles[indexId].Nom</h2></div>
    List<ArticleViewModel> articles = new List<ArticleViewModel>();
    while (i < Model.Articles.Count && Model.Articles[i].Article.FamilleId == familleId)
    {
        articles.Add(Model.Articles[i]);
        i++;
    }
    if (i != Model.Articles.Count)
    {
        familleId = Model.Articles[i].Article.FamilleId;
        indexId = familles.FindIndex(f => f.Id == familleId);
    }
    <section class="notreCarte">
        @foreach (ArticleViewModel a in articles)
        {
            string effet = "";
            bool dansCarte = true;
            if (!a.Article.DansCarte)
            {
                effet = "class=pasDansCarte";
                dansCarte = false;
            }
            <div id="@a.NomPourUrl" class="indexArticle">
                <a @effet href="/Article/@a.NomPourUrl">
                    <img src="@dossierImagesArticles/@a.Article.Image" alt="@a.Article.Nom" />
                </a>
                <div class="articleDescription">
                    <a href="/Article/@a.NomPourUrl">
                        <p>@a.Article.Nom</p>
                        <p>@a.Article.Prix.ToString("C2", new CultureInfo("fr-FR"))</p>
                    </a>
                </div>
                <div id="ajoutPanier">
                    @if (dansCarte)
                    {
                        using (Html.BeginForm("Ajouter", "Panier", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "prix_submit" }))
                        {
                            <input name="nom" value="@a.Article.Nom" hidden>
                            <input type="hidden" name="ancre" value="#@a.NomPourUrl">
                            <button class="ajoutPanier" type="submit">Ajouter au panier</button>
                        }
                    }
                    @if (ViewBag.AdminArticle)
                    {
                        using (Html.BeginForm("ModifierArticle", "Administration", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "admin_article" }))
                        {
                            <input type="hidden" name="id" value="@a.Article.Id">
                            <button class="adminArticle" type="submit">Modifier</button>
                        }
                    }
                </div>
            </div>
        }
    </section>
}
